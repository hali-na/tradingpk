# TradingPK - PK 顶级交易员产品设计方案

## 📋 产品概述

**TradingPK** 是一个让用户与顶级交易员 paul wei 进行模拟交易 PK 的平台。用户可以选择 paul wei 的历史交易时间段，在相同的市场环境下进行模拟交易，并对比双方的交易表现。

---

## 🎯 核心功能设计

### 1. **挑战选择页面** (Challenge Selection)

#### 功能描述
用户可以选择一个时间段进行挑战，该时间段会包含 paul wei 的 1 次或多次交易记录。挑战在该时间段结束时自动结算。

#### 页面元素

**1.1 时间段选择器（主要方式）**
- **日历选择器**
  - 用户可以选择开始日期和结束日期
  - 显示该时间段内 paul wei 的交易统计：
    - 交易次数
    - 涉及交易对
    - paul wei 在该时间段的收益率
    - 交易方向分布
  - 提示："该时间段包含 paul wei 的 X 次交易"

- **预设时间段**
  - "今天" - 选择今天（如果 paul wei 今天有交易）
  - "最近 7 天"
  - "最近 30 天"
  - "最近 3 个月"
  - "最近 1 年"

- **智能推荐时间段**
  - 基于 paul wei 的交易记录，推荐有意义的时间段：
    - "最佳表现周" - paul wei 收益率最高的一周
    - "最活跃周" - paul wei 交易次数最多的一周
    - "经典战役" - 包含 paul wei 重要交易的时间段

**1.2 交易列表视图（辅助方式）**
- 显示 paul wei 的所有交易记录（按时间倒序）
- 每个交易卡片显示：
  - 交易日期范围（开始时间 - 结束时间）
  - 交易对（XBTUSD / ETHUSD）
  - 交易方向（Long / Short）
  - paul wei 的收益率
  - 持仓时长
  - 交易次数
- **点击交易卡片** → 自动选择该交易的时间段作为挑战时间段
- 支持筛选：按交易对、时间范围、收益率排序

**1.3 时间轴视图（可视化辅助）**
- 可视化时间轴，显示 paul wei 的所有交易区间
- 用户可以拖拽选择时间段
- 点击任意区间即可开始挑战

**1.4 快速挑战按钮**
- "挑战最佳交易" - 选择 paul wei 收益率最高的交易所在的时间段
- "挑战最近交易" - 选择最近一次交易的时间段
- "随机挑战" - 随机选择一个时间段

#### 挑战时间设计逻辑（产品经理建议）

**方案 A：固定时间段（推荐）**
- 用户选择一个固定的时间段（如：2020-05-01 到 2020-05-07）
- 挑战在该时间段的结束时间自动结算
- **优点：**
  - 简单清晰，用户容易理解
  - 公平对比：双方都在相同的时间段内交易
  - 便于计算和展示
- **缺点：**
  - 用户可能觉得时间不够灵活

**方案 B：用户主动结束（备选）**
- 用户选择一个时间段，但可以提前结束挑战
- 如果用户提前结束，则对比双方在该时间点之前的表现
- **优点：**
  - 更灵活，用户可以随时结束
- **缺点：**
  - 对比可能不够公平（paul wei 可能后续还有更好的表现）

**推荐：方案 A（固定时间段）**
- 更符合"PK"的概念：在相同条件下公平竞争
- 用户选择时间段时已经知道挑战的时长
- 可以在挑战详情中明确显示："挑战时长：7 天"

#### 交互流程
```
用户选择时间段 → 显示挑战详情（包含该时间段内 paul wei 的交易） → 确认开始 → 进入交易页面
```

---

### 2. **交易页面** (Trading Interface)

#### 核心布局（三栏式）

```
┌─────────────────────────────────────────────────────────┐
│  Header: 挑战信息 + 实时对比 + 时间控制                   │
├──────────────┬──────────────┬───────────────────────────┤
│              │              │                           │
│  K线图表     │  交易面板     │  对比面板                  │
│  (60%)       │  (20%)       │  (20%)                    │
│              │              │                           │
│  - 多时间周期 │  - 下单界面   │  - 实时收益对比            │
│  - 标记paul  │  - 持仓列表   │  - 交易次数对比            │
│    wei操作   │  - 订单历史   │  - 持仓时长对比            │
│  - 时间加速  │              │  - 资金使用率对比           │
│  - 播放/暂停 │              │                           │
└──────────────┴──────────────┴───────────────────────────┘
```

#### 2.1 K线图表区域

**功能：**
- **多时间周期切换：**
  - 支持 1m / 5m / 1h / 1d 四个时间周期
  - 用户可以在交易过程中随时切换
  - 切换时保持当前视图位置（不跳转）
  - 不同周期显示不同粒度的数据：
    - 1m：最详细，适合短线交易
    - 5m：平衡，适合日内交易
    - 1h：适合趋势分析
    - 1d：适合长期持仓

- **关键标记：**
  - 🟢 绿色标记：paul wei 的买入点
  - 🔴 红色标记：paul wei 的卖出点
  - 📍 蓝色标记：用户的交易点
  - 标记会根据时间周期自动调整显示密度

- **时间轴限制：**
  - 用户只能在挑战时间段内进行交易
  - K 线图显示挑战时间段的完整数据
  - 支持缩放、平移（但限制在挑战时间范围内）
  - 显示挑战剩余时间倒计时

- **时间加速功能（核心创新）：**
  - **时间流速控制：**
    - 1x（正常速度）- 实时模拟，按实际时间流逝
    - 2x / 5x / 10x / 50x / 100x - 加速模拟
    - 最大速度：100x（1 小时挑战在 36 秒内完成）
  - **时间控制面板：**
    ```
    [⏸️ 暂停] [▶️ 播放] [⏩ 加速] [⏪ 减速]
    当前速度: 10x
    剩余时间: 2小时 15分钟
    ```
  - **播放/暂停：**
    - 用户可以随时暂停时间流逝
    - 暂停时仍可以查看 K 线、分析行情、下单
    - 暂停时，限价单和止损单不会触发
  - **加速效果：**
    - K 线按加速后的速度逐根出现
    - 价格实时更新（基于历史数据）
    - 限价单和止损单在加速过程中也会触发
    - 浮动盈亏实时更新
  - **智能加速建议：**
    - 当用户长时间无操作时，提示"是否加速时间？"
    - 当 paul wei 有交易时，自动减速到 1x 让用户观察
    - 用户下单后，自动暂停让用户确认

- **实时更新：**
  - 用户持仓的浮动盈亏（按当前时间点的价格）
  - 当前价格（基于历史 K 线数据，按时间流速更新）
  - 限价单和止损单的触发检测（按时间流速）

**技术实现：**
- 使用 Lightweight Charts 或 TradingView Charting Library
- 时间模拟引擎：
  - 维护一个"模拟时间"变量
  - 根据时间流速，快速推进模拟时间
  - 根据模拟时间，从历史 K 线数据中获取当前价格
  - 实时检测限价单和止损单的触发条件

#### 2.2 交易面板

**时间控制区域（顶部）：**
- **时间流速控制：**
  - 速度选择器：1x / 2x / 5x / 10x / 50x / 100x
  - **重要：** 用户可以在挑战过程中随时切换速度，无需暂停
  - 播放/暂停按钮
  - 当前模拟时间显示
  - 剩余时间倒计时
- **快捷操作：**
  - "跳到 paul wei 交易点" - 快速跳转到 paul wei 的交易时间
  - "跳到结束" - 快速跳到挑战结束时间（用于快速结算）

**下单区域：**
- 交易对选择（自动锁定为挑战的交易对）
- 方向选择：Long / Short
- 数量输入（支持按 USD 或合约数量）
- 订单类型：
  - 市价单（Market）- 立即按当前价格成交
  - 限价单（Limit）- 需输入价格，当价格达到时成交
  - 止损单（Stop Loss）- 需输入触发价格，当价格达到时成交
- "下单" 按钮
- **注意：** 在时间加速模式下，限价单和止损单也会正常触发

**持仓列表：**
- 显示当前所有持仓
- 每个持仓显示：
  - 方向、数量、开仓价格
  - 当前价格、浮动盈亏（实时更新）
  - 开仓时间
  - "平仓" 按钮（立即市价平仓）

**订单历史：**
- 显示所有已执行的订单
- 显示所有未成交的限价单/止损单
- 支持撤销未成交订单
- **时间加速提示：** 显示订单在加速模式下的执行情况

#### 2.3 对比面板（实时更新）

**实时对比指标：**

1. **收益率对比**
   ```
   用户收益率: +5.2%
   paul wei:   +8.7%
   差距:       -3.5% ⬇️
   ```

2. **交易次数对比**
   ```
   用户: 3 次
   paul wei: 1 次
   ```

3. **持仓时长对比**
   ```
   用户平均持仓: 2.5 小时
   paul wei:     4.2 小时
   ```

4. **资金使用率对比**
   ```
   用户: 85%
   paul wei: 60%
   ```

5. **最大回撤对比**
   ```
   用户: -2.1%
   paul wei: -1.5%
   ```

6. **胜率对比**（如果用户已完成多次交易）
   ```
   用户: 66.7% (2/3)
   paul wei: 100% (1/1)
   ```

**进度条可视化：**
- 时间进度条：显示挑战已进行的时间百分比
- 收益对比进度条：直观显示双方收益差距

---

### 3. **结算页面** (Results Page)

#### 触发条件
- 用户主动结束挑战（点击"结束挑战"按钮）
- 挑战时间段结束（自动结算）

#### 页面内容

**3.1 核心对比卡片**

```
┌─────────────────────────────────────┐
│         🏆 挑战结果                  │
├─────────────────────────────────────┤
│  用户收益率:  +5.2%                  │
│  paul wei:    +8.7%                  │
│                                     │
│  结果: 惜败 😔 (差距 -3.5%)          │
└─────────────────────────────────────┘
```

**3.2 详细数据对比表**

| 指标 | 用户 | paul wei | 差距 |
|------|------|----------|------|
| 总收益率 | +5.2% | +8.7% | -3.5% |
| 交易次数 | 3 | 1 | +2 |
| 平均持仓时长 | 2.5h | 4.2h | -1.7h |
| 最大回撤 | -2.1% | -1.5% | -0.6% |
| 资金使用率 | 85% | 60% | +25% |
| 手续费占比 | 0.8% | 0.3% | +0.5% |

**3.3 交易时间线对比**

- 并排显示用户和 paul wei 的交易时间线
- 标记每次开仓/平仓的时间点
- 显示每次交易的盈亏

**3.4 收益曲线对比图**

- 双线图：显示用户和 paul wei 的累计收益曲线
- X轴：时间
- Y轴：累计收益率

**3.5 操作建议（AI 分析）**

- 基于对比数据，给出改进建议
- 例如：
  - "您的交易频率较高，建议减少交易次数以降低手续费"
  - "paul wei 的持仓时间更长，可能更适合趋势交易"
  - "您的资金使用率较高，风险相对更大"

**3.6 分享功能（病毒传播核心）**

#### 设计目标
- 让用户有强烈的分享欲望
- 通过精美的视觉设计吸引他人点击
- 无需登录即可体验，降低分享门槛

#### 分享卡片设计

**3.6.1 挑战结果卡片（可下载为图片）**

```
┌─────────────────────────────────────────┐
│  🏆 TradingPK - PK 顶级交易员            │
│                                         │
│  ┌─────────────┐    ┌─────────────┐   │
│  │   用户      │ VS │  paul wei   │   │
│  │  +5.2% 📈  │    │  +8.7% 📈  │   │
│  └─────────────┘    └─────────────┘   │
│                                         │
│  结果: 惜败 😔 (差距 -3.5%)             │
│                                         │
│  挑战时间段: 2020-05-01 ~ 2020-05-07    │
│  交易对: XBTUSD                         │
│                                         │
│  ───────────────────────────────────   │
│  扫码或访问 tradingpk.com 开始挑战      │
│  [二维码]                                │
└─────────────────────────────────────────┘
```

**设计要点：**
- 使用品牌色和渐变背景
- 大号数字突出收益率
- 表情符号增加趣味性
- 包含二维码，方便移动端分享
- 底部显示网站链接

**3.6.2 分享按钮**
- "生成分享图" - 生成精美的挑战结果卡片
- "保存到相册" - 直接保存图片（移动端）
- "分享到微信" - 调用微信分享 API（如果支持）
- "复制链接" - 复制挑战结果链接（如果未来支持）

**3.6.3 分享文案模板**
根据挑战结果自动生成不同的分享文案：

- **胜利：** "我在 TradingPK 上击败了顶级交易员 paul wei！收益率 +12.5% vs +8.7% 🎉"
- **惜败：** "挑战 paul wei 失败，但学到了很多！收益率 +5.2% vs +8.7% 📚"
- **大胜：** "完胜 paul wei！我的收益率是他的 2 倍！🔥"
- **大败：** "被 paul wei 完虐... 收益率 -3.2% vs +8.7%，还要继续学习 💪"

**3.6.4 病毒传播策略**

1. **社交分享优化**
   - 分享卡片包含完整的挑战信息
   - 二维码直接链接到挑战选择页面
   - 分享文案具有话题性和挑战性

2. **无需登录设计**
   - 新用户点击分享链接后，可以直接开始挑战
   - 降低使用门槛，提高转化率

3. **挑战记录本地保存**
   - 用户的所有挑战记录保存在 LocalStorage
   - 可以查看历史挑战，生成历史分享图
   - 未来可以支持导出 JSON 格式

4. **排行榜设计（可选，未来扩展）**
   - 如果未来需要排行榜，可以考虑：
     - 用户主动提交挑战结果（可选）
     - 基于挑战 ID 的排行榜（同一挑战的玩家对比）
     - 匿名排行榜（只显示收益率，不显示用户名）

---

## 🔑 核心算法设计

### 1. **收益率计算**

#### 用户收益率
```
用户收益率 = (当前权益 - 初始权益) / 初始权益 × 100%

其中：
- 初始权益 = 挑战开始时的虚拟资金（10,000 USD）
- 当前权益 = 初始权益 + 累计已实现盈亏 + 当前浮动盈亏 - 累计手续费
```

#### paul wei 收益率（在挑战时间段内）
```
paul wei 收益率 = (挑战结束时的权益 - 挑战开始时的权益) / 挑战开始时的权益 × 100%

注意：需要从 wallet_history 中提取挑战时间段内的权益变化
```

### 1.1 **手续费计算（重要）**

#### 用户手续费
- **按照历史实际手续费率计算**
- 从 paul wei 的交易记录中提取该时间段的手续费率
- BitMEX 手续费率（历史）：
  - Maker: 0.025% (可能随时间变化)
  - Taker: 0.075% (可能随时间变化)
- **实现方式：**
  - 从 `bitmex_executions.csv` 中提取该时间段的手续费率
  - 如果数据中没有，则使用该时间段 BitMEX 的官方手续费率
  - 用户下单时，根据订单类型（限价单=Maker，市价单=Taker）计算手续费

#### paul wei 手续费
- 直接使用历史数据中的实际手续费（从 `bitmex_executions.csv` 的 `execComm` 字段）
- 确保用户和 paul wei 使用相同的手续费标准

### 2. **时间匹配策略**

#### 场景 1：用户在 paul wei 一次交易区间内多次交易
- **处理方式：** 正常记录用户的所有交易
- **对比方式：** 
  - 用户总收益率 vs paul wei 在该区间的总收益率
  - 额外显示：用户交易频率 vs paul wei 交易频率

#### 场景 2：用户一次交易，paul wei 多次交易
- **处理方式：** 正常记录用户和 paul wei 的所有交易
- **对比方式：**
  - 用户单次交易收益率 vs paul wei 在该时间段内的累计收益率
  - 说明：paul wei 通过多次交易可能获得更好的平均成本

#### 场景 3：用户和 paul wei 交易时间不完全重叠
- **处理方式：** 
  - 以用户选择的挑战时间段为基准
  - 用户可以在该时间段内任意时间交易
  - paul wei 在该时间段内的所有交易都会被包含
  - 对比时，双方都基于相同的时间段计算收益率

#### 场景 4：用户做与 paul wei 相反的方向
- **处理方式：** 完全允许
- **对比方式：**
  - 正常计算双方的收益率
  - 如果用户做空而 paul wei 做多，收益率会呈现相反趋势
  - 这增加了挑战的趣味性和策略多样性

### 3. **公平性保证**

#### 初始资金相同
- 用户和 paul wei 都使用相同的初始虚拟资金（10,000 USD）
- paul wei 的历史交易按比例缩放到相同的初始资金

#### 手续费计算（已更新）
- **用户手续费：** 按照历史实际手续费率计算
  - 从 paul wei 的交易记录中提取该时间段的手续费率
  - 根据订单类型：限价单=Maker，市价单=Taker
- **paul wei 手续费：** 直接使用历史数据中的实际手续费
- **确保公平：** 双方使用相同的手续费标准

#### 滑点处理
- 用户市价单：考虑滑点（可配置，默认 0.1%）
- 用户限价单：按限价成交（如果价格达到）
- paul wei：使用历史实际成交价格（无滑点，因为这是历史数据）

#### 时间公平性
- 双方都在相同的挑战时间段内进行交易
- 用户可以选择在时间段内的任意时间交易
- 对比时，双方都基于相同的时间段计算收益率

---

## 📱 页面结构

### 路由设计

```
/                          # 首页（挑战选择页面）
/challenge/:id            # 交易页面（进行中的挑战）
/results/:id              # 结算页面（挑战结果）
/history                  # 历史挑战记录（本地存储）
/share/:id                # 分享页面（展示挑战结果，可生成分享图）
```

**注意：** 
- 所有路由都是客户端路由，无需后端
- `/results/:id` 和 `/share/:id` 可以从 LocalStorage 读取挑战数据
- 分享链接可以包含挑战 ID，新用户点击后可以看到挑战结果，然后开始自己的挑战

### 数据流设计

```
1. 用户选择挑战
   ↓
2. 加载挑战数据：
   - paul wei 的交易记录（挑战时间段内）
   - K 线数据（挑战时间段，包含 1m/5m/1h/1d 所有周期）
   ↓
3. 初始化用户账户：
   - 初始资金：10,000 USD
   - 持仓：空
   - 订单：空
   - 模拟时间：挑战开始时间
   - 时间流速：1x（正常速度）
   ↓
4. 时间模拟引擎启动：
   - 根据时间流速推进模拟时间
   - 从历史 K 线数据中获取当前价格
   - 检测限价单/止损单触发条件
   - 更新浮动盈亏
   ↓
5. 用户进行交易：
   - 可以随时调整时间流速
   - 可以暂停/播放时间
   - 可以切换 K 线时间周期
   ↓
6. 实时计算：
   - 用户当前权益（基于模拟时间点的价格）
   - 用户收益率
   - 与 paul wei 的对比
   ↓
7. 挑战结束（到达结束时间） → 结算页面
```

---

## 🎨 UI/UX 设计原则

### 1. **简洁性**
- 避免信息过载
- 核心信息突出显示
- 次要信息可折叠/隐藏

### 2. **实时反馈**
- 每次交易后立即更新对比数据
- 使用动画效果突出变化
- 颜色编码：绿色（盈利）、红色（亏损）

### 3. **可视化**
- 大量使用图表而非纯数字
- K 线图上清晰标记交易点
- 收益曲线对比直观

### 4. **游戏化元素**
- 挑战结果有明确的"胜负"判定
- 可以保存成就/徽章
- 历史挑战记录可查看

---

## 🔧 技术架构建议

### 前端
- **框架：** Next.js 16 + React 19
- **图表：** Lightweight Charts（K线） + Recharts（统计图表）
- **状态管理：** Zustand 或 React Context
- **样式：** Tailwind CSS

### 后端/数据处理
- **API 路由：** Next.js API Routes（仅用于数据加载，不存储用户数据）
- **数据存储：** 
  - **用户交易记录：** LocalStorage（单机存储）
  - **挑战记录：** LocalStorage（保存所有挑战历史）
  - **用户设置：** LocalStorage（如初始资金、滑点设置等）
  - **无需登录：** 完全单机运行，所有数据存储在浏览器本地
- **计算引擎：** 
  - 收益率计算：前端实时计算
  - 数据预处理：服务端预处理 paul wei 的交易数据（静态数据）
  - K 线数据：静态文件或 API 加载

### 数据模型

```typescript
// 挑战定义
interface Challenge {
  id: string;
  paulWeiTradeId: string;
  symbol: 'XBTUSD' | 'ETHUSD';
  startTime: string;
  endTime: string;
  paulWeiReturn: number;
  paulWeiTrades: Trade[];
}

// 时间模拟状态
interface TimeSimulationState {
  currentTime: string;        // 当前模拟时间
  speed: number;               // 时间流速 (1x, 2x, 5x, 10x, 50x, 100x)
  isPaused: boolean;           // 是否暂停
  startTime: string;           // 挑战开始时间
  endTime: string;             // 挑战结束时间
}

// 用户交易
interface UserTrade {
  id: string;
  challengeId: string;
  timestamp: string;           // 交易时间（模拟时间）
  side: 'Buy' | 'Sell';
  price: number;
  quantity: number;
  orderType: 'Market' | 'Limit' | 'Stop';
  fee: number;                 // 手续费
}

// 用户持仓
interface UserPosition {
  side: 'Long' | 'Short';
  quantity: number;
  entryPrice: number;
  entryTime: string;           // 开仓时间（模拟时间）
  unrealizedPnl: number;       // 浮动盈亏（基于当前模拟时间的价格）
}

// 用户订单（未成交）
interface UserOrder {
  id: string;
  challengeId: string;
  type: 'Limit' | 'Stop';
  side: 'Buy' | 'Sell';
  price: number;               // 限价或止损触发价
  quantity: number;
  createdAt: string;           // 创建时间（模拟时间）
  status: 'Pending' | 'Filled' | 'Cancelled';
}

// K线数据（多时间周期）
interface OHLCVData {
  timestamp: string;
  open: number;
  high: number;
  low: number;
  close: number;
  volume: number;
  trades: number;
}

interface OHLCVDataset {
  '1m': OHLCVData[];
  '5m': OHLCVData[];
  '1h': OHLCVData[];
  '1d': OHLCVData[];
}

// 挑战结果
interface ChallengeResult {
  challengeId: string;
  userReturn: number;
  paulWeiReturn: number;
  userTrades: UserTrade[];
  comparison: ComparisonMetrics;
  timeSpent: number;           // 实际花费的时间（秒）
  simulationTime: number;     // 模拟的时间（秒）
  averageSpeed: number;        // 平均时间流速
}
```

---

## 🚀 开发优先级

### Phase 1: MVP（最小可行产品）
1. ✅ 挑战选择页面（列表视图）
2. ✅ 基础交易页面（K线图 + 下单 + 持仓）
3. ✅ 基础对比面板（收益率对比）
4. ✅ 结算页面（核心对比）
5. ✅ 时间加速功能（1x/2x/5x/10x，播放/暂停）
6. ✅ K线多时间周期（1m/5m/1h/1d 切换）

### Phase 2: 增强功能
1. 时间轴视图
2. 详细对比指标（交易次数、持仓时长等）
3. 收益曲线对比图
4. 历史挑战记录

### Phase 3: 优化
1. AI 分析建议
2. 分享功能
3. 排行榜
4. 更多可视化

---

## ✅ 已确认问题

1. **初始资金：** ✅ 10,000 USD（用户和 paul wei 相同）

2. **挑战时间限制：** ✅ 
   - 用户选择一个时间段（包含 paul wei 的 1-多次交易）
   - 挑战在该时间段结束时自动结算
   - 用户不需要在 paul wei 的交易时间段内完成，可以在整个挑战时间段内任意交易

3. **paul wei 收益率计算：** ✅ 
   - 只计算挑战时间段内的收益率

4. **数据存储：** ✅ 
   - 用户交易记录只存在本地（LocalStorage）
   - 不需要用户登录和云端同步
   - 完全单机在线小游戏

5. **交易限制：** ✅ 
   - 允许用户做与 paul wei 相反的方向（完全自由）

6. **手续费：** ✅ 
   - 用户和 paul wei 都按照历史实际手续费计算
   - 用户手续费根据订单类型（Maker/Taker）和历史费率计算
   - paul wei 手续费直接使用历史数据

---

## 🎯 病毒传播性设计总结

### 核心策略：**分享驱动 + 零门槛**

1. **精美的分享卡片**
   - 自动生成挑战结果图片
   - 包含二维码和网站链接
   - 具有话题性的分享文案

2. **无需登录**
   - 新用户点击分享链接即可直接体验
   - 降低使用门槛，提高转化率

3. **挑战性内容**
   - "PK 顶级交易员" 具有天然的话题性
   - 胜负结果容易引发讨论和二次分享

4. **未来扩展（可选）**
   - 如果数据允许，可以添加匿名排行榜
   - 可以添加"挑战好友"功能（通过分享链接）
   - 可以添加"每日挑战"功能（每天推荐一个时间段）

### 传播路径

```
用户完成挑战 
  ↓
生成分享图 
  ↓
分享到社交媒体（微信、微博、Twitter 等）
  ↓
朋友点击链接/二维码
  ↓
直接进入挑战选择页面
  ↓
开始自己的挑战
  ↓
循环...
```

---

## 🕐 挑战时间设计详细说明

### 产品经理建议：**固定时间段方案**

#### 设计理念
用户选择一个时间段，该时间段会包含 paul wei 的 1 次或多次交易记录。挑战在该时间段的结束时间自动结算。

#### 具体实现

**1. 时间段选择方式**

**方式 A：日历选择器（推荐）**
- 用户选择开始日期和结束日期
- 系统自动识别该时间段内 paul wei 的所有交易
- 显示提示："该时间段包含 paul wei 的 X 次交易"
- 用户确认后开始挑战

**方式 B：点击交易记录**
- 用户点击 paul wei 的某次交易记录
- 系统自动选择该交易的时间段（交易开始时间 ~ 交易结束时间）
- 如果该时间段内还有其他交易，一并包含

**方式 C：智能推荐**
- 系统推荐有意义的时间段：
  - "最佳表现周" - paul wei 收益率最高的一周
  - "最活跃周" - paul wei 交易次数最多的一周
  - "经典战役" - 包含 paul wei 重要交易的时间段

**2. 挑战进行中**

- **时间限制：** 用户只能在挑战时间段内进行交易
- **K 线图：** 只显示挑战时间段的数据
- **倒计时：** 显示挑战剩余时间
- **自动结算：** 当到达挑战结束时间时，自动跳转到结算页面

**3. 时间匹配示例**

**示例 1：**
- 用户选择时间段：2020-05-01 00:00 ~ 2020-05-07 23:59
- paul wei 在该时间段内有 3 次交易：
  - 交易 1：2020-05-01 09:00 ~ 2020-05-01 11:47
  - 交易 2：2020-05-02 14:30 ~ 2020-05-03 08:15
  - 交易 3：2020-05-05 10:00 ~ 2020-05-06 16:20
- 用户可以在整个 7 天内任意时间交易
- 挑战在 2020-05-07 23:59 自动结算
- 对比双方在 7 天内的总收益率

**示例 2：**
- 用户点击 paul wei 的某次交易（2020-05-01 09:00 ~ 2020-05-01 11:47）
- 系统自动选择该时间段作为挑战时间段
- 用户可以在 2.8 小时内任意交易
- 挑战在 2020-05-01 11:47 自动结算

**4. 优势分析**

✅ **公平性：** 双方都在相同的时间段内交易，对比公平
✅ **清晰性：** 用户明确知道挑战的时长和结束时间
✅ **灵活性：** 用户可以选择任意时间段，不局限于单次交易
✅ **完整性：** 如果时间段内包含多次交易，可以全面对比

**5. 用户体验优化**

- **挑战详情页：** 在开始挑战前，显示：
  - 挑战时间段
  - 该时间段内 paul wei 的交易次数和收益率
  - 预计挑战时长
  - "确认开始" 按钮

- **交易页面：** 
  - 顶部显示挑战剩余时间（倒计时）
  - 时间进度条显示已进行的时间百分比
  - 接近结束时，提示用户准备结算

---

## ⏱️ 时间加速功能详细说明

### 设计理念
因为是模拟挑战，用户不需要等待真实时间流逝。通过时间加速功能，用户可以快速体验完整的交易过程，提高用户体验和学习效率。

### 功能特性

**1. 时间流速控制**
- **速度选项：** 1x / 2x / 5x / 10x / 50x / 100x
- **速度说明：**
  - 1x：正常速度（1 秒 = 1 秒）
  - 10x：10 倍速度（1 秒 = 10 秒）
  - 100x：100 倍速度（1 小时挑战在 36 秒内完成）
- **速度切换：** 
  - ✅ **用户可以在挑战过程中随时切换速度，无需暂停**
  - 切换速度时，时间模拟会立即应用新的流速
  - 例如：从 10x 切换到 1x，时间流逝会立即变慢
  - 例如：从 1x 切换到 100x，可以快速推进到挑战结束

**2. 播放/暂停控制**
- **暂停功能：**
  - 暂停时，时间停止流逝
  - 用户可以分析行情、查看数据、下单
  - 限价单和止损单在暂停时不会触发
- **播放功能：**
  - 恢复时间流逝
  - 继续执行未完成的订单检测

**3. K线流速控制**
- **K线更新：** 根据时间流速，K线按比例快速出现
- **价格更新：** 当前价格根据模拟时间从历史数据中获取
- **视觉效果：**
  - 低速度（1x-5x）：K线平滑出现
  - 高速度（10x-100x）：K线快速刷新，但保持可读性

**4. 订单执行逻辑**
- **市价单：** 立即按当前模拟时间的价格成交
- **限价单：** 在时间加速过程中，持续检测价格是否达到限价
- **止损单：** 在时间加速过程中，持续检测价格是否触发止损
- **执行时机：** 无论时间流速多快，订单都会在正确的模拟时间点执行

**5. 智能提示**
- **长时间无操作：** 提示"是否加速时间？"
- **paul wei 交易点：** 自动减速到 1x，让用户观察
- **用户下单后：** 自动暂停让用户确认
- **接近结束：** 提示"挑战即将结束"

**6. 时间跳转功能**
- **跳到 paul wei 交易点：** 快速跳转到 paul wei 的交易时间
- **跳到结束：** 快速跳到挑战结束时间（用于快速结算）
- **时间选择器：** 可以手动选择跳转到任意时间点

### 技术实现要点

**1. 时间模拟引擎**
```typescript
// 伪代码
class TimeSimulationEngine {
  currentTime: Date;
  speed: number;
  isPaused: boolean;
  
  tick() {
    if (!isPaused) {
      const delta = (Date.now() - lastTick) * speed;
      currentTime += delta;
      updatePrice(currentTime);
      checkOrders(currentTime);
    }
  }
}
```

**2. 价格获取**
- 根据模拟时间，从历史 K 线数据中插值获取当前价格
- 支持不同时间周期的价格获取（1m/5m/1h/1d）

**3. 订单检测**
- 在每次时间推进时，检测所有未成交订单
- 如果价格达到限价或止损价，立即执行订单

**4. 性能优化**
- 高速度时，可以降低 UI 更新频率
- 使用 Web Worker 处理时间模拟，避免阻塞主线程

**5. K线时间周期切换**
- **数据加载：** 预加载所有时间周期的 K 线数据
- **切换逻辑：** 切换时保持当前模拟时间点，只改变显示粒度
- **标记显示：** 根据时间周期自动调整交易标记的显示密度

---

## 📝 总结

这个设计方案的核心思路是：
1. **公平对比**：双方使用相同的初始资金，在相同的时间段内交易
2. **实时反馈**：用户每次交易后立即看到与 paul wei 的对比
3. **多维度分析**：不仅对比收益率，还对比交易风格（频率、持仓时长等）
4. **简洁直观**：界面简洁，核心信息突出，大量使用可视化
5. **时间加速**：支持时间加速和暂停，提高用户体验和学习效率
6. **多时间周期**：支持 1m/5m/1h/1d 四个时间周期，满足不同交易风格

请确认以上方案是否符合您的预期，我们可以根据您的反馈进行调整！

